<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MotoLog ‚Äî Leaderboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <div class="dashboard-container">
    {% include '_navbar.html' %}

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div style="margin-top:18px;">
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="flash-message {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
        </div>
      {% endif %}
    {% endwith %}

    <header style="display:flex; justify-content:space-between; align-items:center; margin-top:18px;">
      <h2 style="margin:0; font-weight:800;">üèÜ Leaderboards</h2>
      <div style="color:var(--muted)">Local: <strong style="color:var(--primary-600)">{{ user_country }}</strong></div>
    </header>

    <section class="leaderboard-section" style="display:grid; grid-template-columns:1fr 360px; gap:20px; margin-top:18px;">
      <!-- Main leaderboard -->
      <div style="background:var(--card-bg); padding:16px; border-radius:16px; box-shadow:var(--shadow-1);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:14px;">
          <div style="font-weight:700; color:var(--muted);">Global</div>
          <div style="color:var(--muted); font-size:0.9rem;">Top riders by distance</div>
        </div>

        <div style="display:flex; flex-direction:column; gap:12px;">
          {% for user in global_leaderboard %}
            <a href="/user/{{ user['id'] }}" style="display:flex; gap:12px; align-items:center; text-decoration:none; color:inherit; padding:10px; border-radius:12px; transition:all 180ms var(--ease);">
              <div style="width:64px; height:64px; border-radius:12px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,var(--n-200),var(--n-100)); box-shadow:var(--shadow-1);">
                {% if user['profile_pic'] %}
                  <img src="{{ user['profile_pic'] }}" style="width:100%; height:100%; object-fit:cover;">
                {% else %}
                  <div style="font-weight:800; color:var(--primary-600);">{{ user['username'][0].upper() }}</div>
                {% endif %}
              </div>
              <div style="flex:1;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                  <div style="font-weight:800;">{{ user['username'] }}</div>
                  <div style="font-weight:800; color:var(--primary-600);">{{ user['total_distance']|default(0) }} km</div>
                </div>
                <div style="color:var(--muted); margin-top:6px;">{{ user['country'] }}</div>
              </div>
            </a>
          {% else %}
            <div style="color:var(--muted); padding:12px;">No data yet.</div>
          {% endfor %}
        </div>
      </div>

      <!-- Sidebar: local -->
      <aside style="display:flex; flex-direction:column; gap:12px;">
        <div class="stat-card">
          <div style="font-weight:700; color:var(--muted);">Local Top</div>
          <div style="margin-top:10px; display:flex; flex-direction:column; gap:10px;">
            {% for user in local_leaderboard %}
              <a href="/user/{{ user['id'] }}" style="display:flex; gap:10px; text-decoration:none; color:inherit; align-items:center;">
                <div style="width:44px; height:44px; border-radius:10px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,var(--n-200),var(--n-100));">
                  {% if user['profile_pic'] %}
                    <img src="{{ user['profile_pic'] }}" style="width:100%; height:100%; object-fit:cover;">
                  {% else %}
                    <div style="font-weight:700; color:var(--primary-600)">{{ user['username'][0].upper() }}</div>
                  {% endif %}
                </div>
                <div style="flex:1;">
                  <div style="font-weight:700;">{{ user['username'] }}</div>
                  <div style="color:var(--muted); font-size:0.9rem;">{{ user['total_distance']|default(0) }} km</div>
                </div>
              </a>
            {% else %}
              <div style="color:var(--muted);">No local riders yet.</div>
            {% endfor %}
          </div>
        </div>

        <div class="stat-card">
          <div style="font-weight:700; color:var(--muted);">Explore</div>
          <div style="margin-top:10px; display:flex; gap:8px;">
            <a href="/leaderboard" class="btn" style="flex:1;">Refresh</a>
            <a href="/dashboard" class="btn btn-secondary" style="flex:1;">My dashboard</a>
          </div>
        </div>
      </aside>
    </section>
  </div>
</body>
</html>