<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MotoLog - My Rides</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <div class="dashboard-container">
    {% include '_navbar.html' %}
    
    <div style="padding: 20px;">
      <h1 style="color: black; font-size: 32px; font-weight: bold; margin: 20px 0;">My Ride History</h1>
      
      {% if rides_list %}
        <!-- Stats Bar -->
        <div style="background-color: #f3f4f6; padding: 20px; margin-bottom: 30px; border-radius: 8px;">
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
            <div>
              <p style="color: #6b7280; font-size: 14px; margin: 0; font-weight: 500;">TOTAL RIDES</p>
              <p style="color: black; font-size: 24px; font-weight: bold; margin: 8px 0 0 0;">{{ rides_list|length }}</p>
            </div>
            <div>
              <p style="color: #6b7280; font-size: 14px; margin: 0; font-weight: 500;">TOTAL DISTANCE</p>
              <p style="color: black; font-size: 24px; font-weight: bold; margin: 8px 0 0 0;">{{ total_distance|round(1) }} km</p>
            </div>
            <div>
              <p style="color: #6b7280; font-size: 14px; margin: 0; font-weight: 500;">SHARED RIDES</p>
              <p style="color: black; font-size: 24px; font-weight: bold; margin: 8px 0 0 0;">{{ shared_count }}</p>
            </div>
          </div>
        </div>
        
        <!-- Rides Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px;">
          {% for ride in rides_list %}
          <div style="background-color: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
              <h3 style="color: black; font-size: 18px; font-weight: bold; margin: 0;">{{ ride.title or 'Untitled Ride' }}</h3>
              {% if ride.public == 1 %}
              <span style="background-color: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">PUBLIC</span>
              {% else %}
              <span style="background-color: #d1d5db; color: #374151; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">PRIVATE</span>
              {% endif %}
            </div>
            
            {% if ride.description %}
            <p style="color: #6b7280; font-size: 14px; margin: 0 0 12px 0;">{{ ride.description }}</p>
            {% endif %}
            
            <p style="color: #9ca3af; font-size: 12px; margin: 0 0 12px 0;">ðŸ“… {{ ride.date }}</p>
            
            <!-- Stats -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e5e7eb;">
              <div>
                <p style="color: #9ca3af; font-size: 12px; margin: 0;">Distance</p>
                <p style="color: black; font-size: 16px; font-weight: bold; margin: 4px 0 0 0;">{{ ride.distance|round(1) }} km</p>
              </div>
              <div>
                <p style="color: #9ca3af; font-size: 12px; margin: 0;">Avg Speed</p>
                <p style="color: black; font-size: 16px; font-weight: bold; margin: 4px 0 0 0;">{{ ride.avg_speed|round(1) }} km/h</p>
              </div>
              <div>
                <p style="color: #9ca3af; font-size: 12px; margin: 0;">Duration</p>
                <p style="color: black; font-size: 16px; font-weight: bold; margin: 4px 0 0 0;">{{ ride.time }}</p>
              </div>
              <div>
                <p style="color: #9ca3af; font-size: 12px; margin: 0;">Top Speed</p>
                <p style="color: black; font-size: 16px; font-weight: bold; margin: 4px 0 0 0;">{{ ride.top_speed|round(1) }} km/h</p>
              </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 8px;">
              <button onclick="location.href='/ride/{{ ride.id }}'" style="flex: 1; background-color: #3b82f6; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 14px;">View</button>
              <button onclick="togglePublic({{ ride.id }}, {{ 1 if ride.public == 0 else 0 }})" style="flex: 1; background-color: #10b981; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 14px;">{% if ride.public == 1 %}Make Private{% else %}Make Public{% endif %}</button>
              <button onclick="deleteRide({{ ride.id }})" style="flex: 1; background-color: #ef4444; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 14px;">Delete</button>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <!-- Empty State -->
        <div style="text-align: center; padding: 60px 20px; background-color: #f9fafb; border-radius: 8px;">
          <h2 style="color: #6b7280; font-size: 24px; font-weight: bold; margin: 0;">No rides yet!</h2>
          <p style="color: #9ca3af; font-size: 16px; margin: 12px 0;">Start tracking your first ride today</p>
          <a href="/track-ride" style="display: inline-block; background-color: #3b82f6; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: 500; margin-top: 12px;">Start Tracking</a>
        </div>
      {% endif %}
    </div>
  </div>

  <script>
    function togglePublic(rideId, makePublic) {
      fetch(`/api/ride/${rideId}/toggle-public`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ public: makePublic })
      })
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          location.reload();
        }
      })
      .catch(e => console.error('Error:', e));
    }

    function deleteRide(rideId) {
      if (confirm('Are you sure you want to delete this ride?')) {
        fetch(`/api/ride/${rideId}`, { method: 'DELETE' })
        .then(r => r.json())
        .then(data => {
          if (data.success) {
            location.reload();
          }
        })
        .catch(e => console.error('Error:', e));
      }
    }
  </script>
</body>
</html>
